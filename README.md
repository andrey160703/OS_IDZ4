# # Домашнее задание по ОС #4
###Гусев Андрей Вадимович БПИ219 - Вариант 31
- ### **Вариант 31:**
 Первая задача об Острове Сокровищ. Шайка пиратов под предводительством Джона Сильвера высадилась на берег Острова Сокровищ. Не смотря на добытую карту старого Флинта, местопо- ложение сокровищ по-прежнему остается загадкой, поэтому искать клад приходится практически на ощупь. Так как Сильвер ходит на деревянной ноге, то самому бродить по джунглям ему не с руки. Джон Сильвер поделил остров на участки, а пиратов на неболь- шие группы. Каждой группе поручается искать клад на одном из участков, а сам Сильвер ждет на берегу. Пираты, обшарив участок, возвращаются к Сильверу и докладывают о результатах. Если клад не найден, то пираты назначаются на другой участок. Требуется создать приложение, моделирующее действия Сильвера и пиратов. Примечание. Количество участков превы- шает число поисковых групп. Сильвер — сервер. Каждая группа пиратов является клиентом.
## **Суть решения (как я понял, что придумал, как реализовал)**
- Размеры острова мы узнаем когда появляемся на острове.
- Где клад и сколько там денег мы тоже не знаем.
- Сначала запускается сервер (Флинт), он хранит только данные об острове (размеры) и ждет запросы других (групп или наблюдателей).
- Когда группа делает запрос - он дает им задания, где искать клад.
- Группы могут сразу не найти клад(он может быть ооочень глубоко зарыт (в коде это выглядит так ```answer = (rand() % 40 == 0 ? rand() % 12345 : -1);``` ))
- Групп (как и наблюдателей) может быть сколько угодно (я подключал 3), так как каждая группа обрабатывается в новом потоке.
- Программа соответствует всем пунктам на оценку 8.
- Регулирование доступа к данным происходит с помощью мутексов (я хранил лог сообщений в массиве и просто считывал их для наблюдателей):
```
pthread_mutex_t mutex_log;
```
- Эта работа отличается от предыдущей - весь код пришлось переписать, потому что предыдущее решение было трудно обновить под протокол udp
- Когда одна из групп все таки выкапывает клад, раскопки завершаются.
- Команды которыми я запускал каждый элемент:
  - Сервер(Флинт):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc server.c -o server -lpthread
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./server 127.0.0.1 8080     
    ```
  - Клиенты(группы):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc client.c -o client    
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./client 127.0.0.1 8080 
    ```
  - Терминалы(наблюдатели):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc terminal.c -o terminal
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./terminal 127.0.0.1 8080
    ```

##Тест программы:
Сервер:
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./server 127.0.0.1 8080  
Ожидание сообщений от клиентов...
Получено число от клиента: -2
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Получено число от клиента: 212
Отправлен ответ клиенту
Получено число от клиента: -1
Отправлен ответ клиенту
Server work ended.
```
Терминал:
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./terminal 127.0.0.1 8080
Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {0:0}

Получен ответ от сервера: Получено число от клиента: -2

Получен ответ от сервера: Флинт послал искать в {0:0}

Получен ответ от сервера: ----------------

Получен ответ от сервера: ----------------

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {1:0}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {2:0}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {3:0}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {4:0}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {0:1}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {1:1}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {2:1}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {3:1}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {4:1}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {0:2}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {1:2}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {2:2}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {3:2}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {4:2}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {0:3}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {1:3}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {2:3}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {3:3}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {4:3}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {0:4}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {1:4}

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: Флинт послал искать в {2:4}

Получен ответ от сервера: Получено число от клиента: 212

Получен ответ от сервера: Получено число от клиента: -1

Получен ответ от сервера: ----------------

Получен ответ от сервера: ----------------

Получен ответ от сервера: ----------------

Получен ответ от сервера: ----------------                
```

Клиент 1(группа 1):
```
andriushaguseff@MacBook-Pro-Andrej dz3 % ./client 127.0.0.1 8080
Подключение к серверу 127.0.0.1:8080
Группе присвоен номер 1
Клад не найден (
Флинт послал искать в {0:0}
Клад не найден (
Флинт послал искать в {1:0}
Клад не найден (
Флинт послал искать в {4:0}
Клад не найден (
Флинт послал искать в {7:0}
Клад не найден (
Флинт послал искать в {1:1}
Клад не найден (
Флинт послал искать в {4:1}
Клад не найден (
Флинт послал искать в {7:1}
Клад не найден (
Флинт послал искать в {4:2}
Клад не найден (
Флинт послал искать в {0:3}
Клад не найден (
Флинт послал искать в {3:3}
Клад не найден (
Флинт послал искать в {6:3}
Клад не найден (
Флинт послал искать в {1:4}
Клад не найден (
Флинт послал искать в {3:4}
Клад не найден (
Флинт послал искать в {5:4}
Нашли клад - 988 денег
Группа 1 закончила раскопки острова%                    
```

Клиент 2(группа 2):
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./client 127.0.0.1 8080 
Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {1:0}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {2:0}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {3:0}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {0:1}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {2:1}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {4:1}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {1:2}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {3:2}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {0:3}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {2:3}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {4:3}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {1:4}

Сообщение отправлено серверу
Группа закончила работу
         
```

Клиент 3(группа 3):
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./client 127.0.0.1 8080 
Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {4:0}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {1:1}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {3:1}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {0:2}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {2:2}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {4:2}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {1:3}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {3:3}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {0:4}

Сообщение отправлено серверу
Получен ответ от сервера: Флинт послал искать в {2:4}

Сообщение отправлено серверу
Группа закончила работу
         
```
